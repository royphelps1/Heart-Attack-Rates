# DSCI-511 Project – Heart Attack Risk in China

## Phase 1 Dataset & Documentation

This repository contains the project work for **DSCI-511: Data Acquisition and Pre-Processing**.  
Phase 1 focused on scoping, cleaning, and enriching a heart-attack dataset related to China.

---

## Team

**DSCI-511 Project Team:**
- Evan Wessel  
- Leland Weeks  
- Shad Scarboro  
- Roy Phelps  

---

### Phase 1 Inputs:
- **Dataset:** `data/raw/heart_attack_china.csv`
- **Data Dictionary:** `docs/data_dictionary.md`
- **Normalized Variables Plan:** `docs/normalized_flags.md`
- **Phase 1 Report Scaffold:** `docs/Phase1_Report_Scaffold.md`

### Phase 1 Output:
- `data/processed/heart_attack_china_enriched.csv`

### Phase 1 Work Includes:
- Initial data cleaning and normalization  
- Creating derived flags (e.g., SBP missing, hypertension thresholds)  
- Standardizing gender categories  
- Building baseline cardiovascular risk attributes  
- File-level documentation and schematics  

---

## Phase 2 – WHO Integration, Merging, Spatial Analysis, and Air Quality

Phase 2 expanded the dataset using **WHO indicators**, **OpenAQ air-quality data**, and a custom geospatial layer to enable **province-level analysis**.

### Key Phase 2 Inputs:
- Phase 1 enriched dataset:  
  - `data/processed/heart_attack_china_enriched.csv`
- WHO indicators dataset:  
  - `data/raw/who_health_china.csv`
- China boundary dataset (GADM / Kaggle):  
  - `data/external/gadm36_CHN_1.json`
- Air quality data via OpenAQ API  
- Province + capital coordinates via Nominatim (OpenStreetMap)

### Custom Dataset Created in Phase 2:
- `data/processed/urban_or_rural_centroids.geojson`

This dataset includes:
- Province name  
- Urban vs Rural classification  
- Latitude / Longitude centroids  

Centroids are generated by:
- Using **OSMnx** (`ox.geocode_to_gdf`) to geocode province names and capitals  
- Computing centroids in a projected CRS and transforming back  
- Writing features as GeoJSON using the `geojson` Python library from a `national_centroid_dict` structure 

---

## Main Notebook

**Phase 2 Implementation Notebook:**  
`notebooks/phase2_all_in_notebook.ipynb`

This notebook performs:

- Cleaning and standardizing WHO indicators  
- Selecting the latest year for each indicator × sex  
- Integrating WHO indicators into the patient-level dataset  
- Querying OpenAQ for PM2.5 air-quality data and merging results  
- Creating three dataset versions:
  - `heart_attack_china_analysis_ready.csv`
  - `heart_attack_china_model_ready.csv` *(kept for future modeling; not used in Phase 2 figures)*
  - `heart_attack_china_with_who_latest_by_sex.csv`
- Aggregating patient-level metrics to the province level:
  - `heart_attack_rate`
  - `mean_sbp`
  - `mean_cvd_risk`
- Constructing GeoDataFrames with GeoPandas  
- Generating choropleth maps of:
  - Heart attack rate by province  
  - Mean SBP by province  
- Adding basemap tiles via **contextily**  
- Creating and visualizing urban/rural centroids  
- Exporting reproducible GeoJSON outputs  

---

## Figures and Maps

All maps and figures are saved to:

reports/figures/



Examples include:
- `heart_attack_rate_by_province.png`
- `mean_sbp_by_province.png`
- `heart_attack_rate_with_basemap.png`
- `mean_sbp_with_basemap.png`
- `urban_rural_centroids_with_labels.png`

---

## Large File Handling

A large patient-level GeoJSON file may be generated:

data/processed/china_heart_attack_analysis.geojson (~760MB)

This file is:
- Excluded from Git via `gitignore`
- Regeneraged automaticaly from the notebook
- Indended only for visualization aand spatial exploration

---

## Reproducibility the Notebook
To reproduce Phase 2 results:

1. Open:  
   `notebooks/phase2_all_in_notebook.ipynb`
2. Run the notebook from top to bottom.
3. Outputs will automatically be written to:

data/processed/
reports/figures/

---

## Project Resources

- **GitHub Repository:**  
https://github.com/royphelps1/DSCI-511-Project

---

# Project References & Data Sources

This project integrates medical data, geographic reference data, and programmatically generated spatial data to support analysis and visualization.

---

## 1. Heart Attack China Dataset
**Source:** Kaggle  
**Description:**  
Dataset containing provincial-level heart attack indicators and related health factors across China, including urban vs rural classification.

**Used for:**
- Primary analysis
- Risk-factor exploration
- Aggregations and statistical analysis

Original source credited on Kaggle.

---

## 2. China Province Boundaries (GADM v3.6)
**Source:** Kaggle (GADM Database of Global Administrative Areas)  
**File:** `gadm36_CHN_1.json`  

**Description:**  
This dataset provides official geographic boundaries for China’s first-level administrative divisions (provinces). The dataset was used strictly for visualization and spatial context.

**Used for:**
- Background map layer
- Geographic reference when plotting centroids

Reference:
https://gadm.org

---

## 3. Wikipedia – Administrative Divisions
**Source:** Wikipedia  

Used to extract province and capital information:

| Page | Purpose |
|------|---------|
| *Provinces of China* | Province names and largest cities |
| *Autonomous regions of China* | Autonomous regions and capitals |
| *Direct-administered municipalities* | Municipalities and capital cities |

Data accessed via Wikipedia REST API and parsed programmatically.

---

## 4. OpenStreetMap / OSMnx
**Source:** OpenStreetMap via Python OSMnx library  
**Library:** `osmnx`  

**Description:**  
Used to geocode province names and capitals and extract centroid coordinates for:

- Rural province centers  
- Urban city centers  

**Used for:**
- Generating custom GeoJSON centroid dataset  
- Latitude/Longitude calculations  

Website:
https://www.openstreetmap.org  
Library documentation:
https://osmnx.readthedocs.io

---

## 5. OpenAQ API (PM2.5 Air Quality)
**Used for:**
- Query PM2.5 data for urban centers  
- Assign rural PM2.5 values (set to 0 by project assumption)  
- Merge environmental exposure values into patient-level data

---

## 6. Custom Spatial Dataset (This Project)
**File:** `urban_or_rural_centroids.geojson`  

**Description:**  
This GeoJSON file was **generated within this project** using:

- Wikipedia data  
- OpenStreetMap geocoding  
- GeoPandas  
- OSMnx  

Contains:
- Province name  
- Urban vs Rural flag  
- Longitude / Latitude coordinate pairs  

**Used for:**
- Provides centroid coordinates for each province and urban / rural region  
- Enables geospatial visualization

---

## 6. Python Libraries Used

| Library | Purpose |
|----------|----------|
| pandas | Data processing and merging |
| geopandas | Spatial analysis and mapping |
| osmnx | Geocoding and centroid extraction |
| shapely | Geometry creation |
| matplotlib | Plotting and visualization |
| beautifulsoup4 | Web scraping and HTML parsing |
| requests | API requests |
| geojson | Writing GeoJSON output |
| contextily | Basemap titles / background maps |

---

## Notes on Data Usage

All external datasets were used for academic purposes only and for demonstration and learning within a university project context.

Code used to generate derived datasets is included within this repository to ensure reproducibility.

---

## Challenges and Limitations

- No timestamp information:  Without event dates, we cannot study trends over time or temporal relationships.
- Heterogeneous data sources:  Aligning Kaggle, WHO, air quality, and OSM data required careful matching of province names and handling missing content.
- Limited medical domain expertise:  Some clinical assumptions were made conservatively and may not relflect all nuances.
- Potential smpling bias:  Representativeness of provinces and demographics is unknown, which limits generalizability.

---


## Repo Structure

```text
.
├── notebooks/           # Jupyter notebooks (Phase 1 & 2 pipelines)
├── src/                 # Reusable Python modules (if needed)
├── tests/               # Optional unit tests
├── data/
│   ├── raw/             # Original datasets (input to the pipeline)
│   ├── processed/       # Analysis-ready datasets (some large files ignored via .gitignore)
│   └── external/        # Geographic reference data (e.g., GADM)
├── reports/
│   └── figures/         # Maps and visualizations generated in Phase 2
├── docs/                # Documentation & scaffolds (data dictionary, normalized flags, proposal docs)
├── references/          # Citation and reference materials
├── environment.yml      # Optional Conda environment (for reproducibility)
├── CONTRIBUTING.md      # Team workflow
└── .gitignore           # Ignore rules for datasets, outputs, LaTeX artifacts, etc.

